@(form: Form[WidgetForm.Data], postUrl: Call, checkbeds: Seq[WidgetForm.CheckBeds], configuration: play.api.Configuration, links: Seq[String], titles: Seq[String])(implicit request: RequestHeader, messages: Messages)

@import views.minimal._
@fc_check = @{ helper.FieldConstructor(minimal.checkboxGroupFieldConstructor.f) }
@fc_price = @{ helper.FieldConstructor(minimal.priceFieldConstructor.f) }

@main("Kiosk") {
  <script type="text/javascript">
    function numberWithCommas(x) {
        var parts = x.toString().split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return parts.join(".");
    }

    function reformat(obj) {
      obj.value = `\$${ numberWithCommas(Math.floor(obj.value.replace(/[^\d\.]/g, '')))}`
    }
  </script>

  @* Flash shows updates to a page *@
  @request.flash.data.map{ case (foo, bar) =>
    <div class=@foo>@bar</div>
  }

  @* Global errors are not tied to any particular form field *@
  @if(form.hasGlobalErrors) {
    @form.globalErrors.map { error: FormError =>
      <div>
        @error.key: @error.message
      </div>
    }
  }

  @helper.form(postUrl) {

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 
    <script src="@routes.Assets.at("javascripts/jquery.autocomplete.js")"></script>
    <script src="@routes.Assets.at("javascripts/semantic.min.js")"></script>
    <script type="text/javascript" src="@routes.WidgetController.javascriptRoutes"></script>

    @helper.CSRF.formField

    Rent between
    @minimal.inputText(field = form("rentlo"))(handler = fc_check, implicitly[Messages])
    and     
    @minimal.inputText(field = form("renthi"))(handler = fc_check, implicitly[Messages])
    in 
    @minimal.inputDropdown(field = form("autocomplete"))(handler = fc_check, implicitly[Messages])

    <script>
    $('.ui.dropdown').dropdown({
        apiSettings: {
          url: '/autocomplete?query={query}'
        },
        keepOnScreen: false,
        values: [
          @if(form("autocomplete").value.exists(_.trim.nonEmpty)) {
            @for(item <- form("autocomplete").value.get.split(",") ) {
              {
                name: '@item',
                value: '@item',
                selected: true,
              },
            }
          }
        ],
    })
    ;
    </script>

    @minimal.inputCheckboxGroup(form("checkbeds"), options = checkbeds.map(g => g.value.toString -> g.name))(handler = fc_check, implicitly[Messages])

    <button>Update</button>
    <hr/>
    
    @for( (l,t) <- (links zip titles)) {
      <p><a href=@l>@t</a>
    }
  }

}
